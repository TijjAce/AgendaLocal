{% extends "base.html" %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-4">Liste des fiches</h1>

    <!-- Formulaire de recherche -->
    <form method="get" class="row g-2 mb-4">
        <div class="col-auto">
            <input type="text" name="q" value="{{ query }}" class="form-control" placeholder="Rechercher...">
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Rechercher</button>
        </div>
    </form>

    <!-- Formulaire Bulk Delete -->
    <form method="post">
        {% csrf_token %}
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th scope="col"><input type="checkbox" id="select_all" /></th>
                        <th scope="col">
                            <a href="?sort=titre&order={% if sort == 'titre' and order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}" class="text-white text-decoration-none">Titre</a>
                        </th>
                        <th scope="col">
                            <a href="?sort=discipline&order={% if sort == 'discipline' and order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}" class="text-white text-decoration-none">Discipline</a>
                        </th>
                        <th scope="col">Groupes</th>
                        <th scope="col">
                            <a href="?sort=date&order={% if sort == 'date' and order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}" class="text-white text-decoration-none">Date</a>
                        </th>
                        <th scope="col">
                            <a href="?sort=heure&order={% if sort == 'heure' and order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}" class="text-white text-decoration-none">Heure</a>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for fiche in fiches %}
                    <tr>
                        <td><input type="checkbox" name="delete" value="{{ fiche.id }}" /></td>
                        <td>{{ fiche.titre }}</td>
                        <td>{{ fiche.discipline.title }}</td>
                        <td>{{ fiche.groupes }}</td>
                        <td>{{ fiche.date|date:"d/m/Y" }}</td>
                        <td>
                            {% if fiche.heure_debut and fiche.heure_fin %}
                                {{ fiche.heure_debut|time:"H:i" }} - {{ fiche.heure_fin|time:"H:i" }}
                            {% else %}
                                Non précisée
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">Aucune fiche trouvée.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <button type="submit" class="btn btn-danger mt-2">Supprimer les sélectionnées</button>
    </form>

    <!-- Pagination -->
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            {% if fiches.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ fiches.previous_page_number }}{% if query %}&q={{ query }}{% endif %}" aria-label="Précédent">
                    <span aria-hidden="true">&laquo; Précédent</span>
                </a>
            </li>
            {% endif %}
            
            <li class="page-item disabled">
                <span class="page-link">Page {{ fiches.number }} sur {{ fiches.paginator.num_pages }}</span>
            </li>
            
            {% if fiches.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ fiches.next_page_number }}{% if query %}&q={{ query }}{% endif %}" aria-label="Suivant">
                    <span aria-hidden="true">Suivant &raquo;</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>

<script>
document.getElementById('select_all').addEventListener('change', function() {
    let checked = this.checked;
    document.querySelectorAll('input[name="delete"]').forEach(cb => cb.checked = checked);
});
</script>
{% endblock %}
