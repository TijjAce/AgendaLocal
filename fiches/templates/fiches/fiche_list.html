{% extends "base.html" %}

{% block content %}
<h1>Liste des fiches</h1>

<form method="get" style="margin-bottom: 1rem;">
    <input type="text" name="q" value="{{ query }}" placeholder="Rechercher..." />
    <button type="submit">Rechercher</button>
</form>

<form method="post">
    {% csrf_token %}
    <table border="1" cellpadding="8" cellspacing="0">
        <thead>
            <tr>
                <th><input type="checkbox" id="select_all" /></th>
                <th><a href="?sort=titre&order={% if sort == 'titre' and order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}">Titre</a></th>
                <th><a href="?sort=discipline&order={% if sort == 'discipline' and order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}">Discipline</a></th>
                <th>Groupes</th>
                <th><a href="?sort=date&order={% if sort == 'date' and order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}">Date</a></th>
                <th><a href="?sort=heure&order={% if sort == 'heure' and order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}">Heure</a></th>
            </tr>
        </thead>
        <tbody>
            {% for fiche in fiches %}
            <tr>
                <td><input type="checkbox" name="delete" value="{{ fiche.id }}" /></td>
                <td>{{ fiche.titre }}</td>
                <td>{{ fiche.discipline.title }}</td>
                <td>{{ fiche.groupes }}</td>
                <td>{{ fiche.date|date:"d/m/Y" }}</td>
                <td>
                    {% if fiche.heure_debut and fiche.heure_fin %}
                        {{ fiche.heure_debut|time:"H:i" }} - {{ fiche.heure_fin|time:"H:i" }}
                    {% else %}
                        Non précisée
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="6">Aucune fiche trouvée.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <button type="submit" style="margin-top: 1rem;">Supprimer les sélectionnées</button>
</form>

<div style="margin-top: 1rem;">
    {% if fiches.has_previous %}
        <a href="?page={{ fiches.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">Précédent</a>
    {% endif %}
    Page {{ fiches.number }} sur {{ fiches.paginator.num_pages }}
    {% if fiches.has_next %}
        <a href="?page={{ fiches.next_page_number }}{% if query %}&q={{ query }}{% endif %}">Suivant</a>
    {% endif %}
</div>

<script>
document.getElementById('select_all').addEventListener('change', function() {
    let checked = this.checked;
    document.querySelectorAll('input[name="delete"]').forEach(cb => cb.checked = checked);
});
</script>
{% endblock %}
